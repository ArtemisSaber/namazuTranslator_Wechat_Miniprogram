"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.formatTime = (date) => {
    const year = date.getFullYear();
    const month = date.getMonth() + 1;
    const day = date.getDate();
    const hour = date.getHours();
    const minute = date.getMinutes();
    const second = date.getSeconds();
    return ([year, month, day].map(formatNumber).join('/') +
        ' ' +
        [hour, minute, second].map(formatNumber).join(':'));
};
exports.initAuxilaryData = () => {
    let dataVersion = exports.getDataVersion();
    dataVersion.then((res) => {
        if (res) {
            let setLocalStor = exports.setLocalStorage('dataVersion', JSON.stringify(res));
            let setEmptyData = exports.getEmptyData();
            setLocalStor.then((res) => {
                console.log(res);
            }).catch((err) => {
                console.log(err);
            });
            setEmptyData.then((res) => {
                console.log(res);
            });
            wx.showToast({
                title: '数据版本已更新',
                icon: 'success',
                duration: 1500
            });
        }
    });
};
exports.getEmptyData = () => {
    return new Promise((resolve, reject) => {
        let blankItems = {
            "zh_cn": [''],
            "ja_jp": ['']
        };
        let blankItemPromise = exports.getJSONData(exports.getAPIPath('itemWithBlankSpace', 'zh-cn'));
        blankItemPromise.then((res) => {
            console.log(res);
            let resData = res.data;
            resData.zh_cn.forEach((e) => {
                blankItems.zh_cn.push(e.ItemName);
            });
            resData.ja_jp.forEach((e) => {
                blankItems.ja_jp.push(e.ItemName);
            });
            let storPromise = exports.setLocalStorage('blankItems', JSON.stringify(blankItems));
            storPromise.then(res => {
                resolve(res);
            }).catch(err => {
                reject(err);
            });
        }).catch(err => {
            reject(err);
        });
    });
};
exports.getDataVersion = () => {
    return new Promise((resolve, reject) => {
        let dataVersion = exports.getJSONData(exports.getAPIPath("dataVersion", "zh-cn"));
        dataVersion.then((res) => {
            console.log(res.data);
            resolve(res.data);
        }).catch(err => {
            console.log(err);
            reject(false);
        });
    });
};
exports.setLocalStorage = (key, data) => {
    return new Promise((resolve, reject) => {
        wx.setStorage({
            key: key,
            data: data,
            success(res) {
                console.log(res);
                resolve(true);
            },
            fail(err) {
                console.log(err);
                reject(false);
            }
        });
    });
};
exports.getLocalStorage = (key) => {
    return new Promise((resolve, reject) => {
        wx.getStorage({
            key: key,
            success(res) {
                console.log(res.data);
                resolve(res.data);
            },
            fail(err) {
                reject(err);
            }
        });
    });
};
exports.removeLocalStorage = (key) => {
    return new Promise((resolve, reject) => {
        wx.removeStorage({
            key: key,
            success(res) {
                console.log(res);
                resolve(true);
            },
            fail(err) {
                console.log(err);
                reject(false);
            }
        });
    });
};
exports.getAPIPath = (endPoint, sourceLang = 'zh-cn') => {
    let host = "https://dirusec.com/namazu/api/";
    switch (endPoint) {
        case ("item"):
            return host + "namazuTranslator/item?lang=" + sourceLang;
            break;
        case ("dataVersion"):
            return host + "namazuTranslator/dataVersion";
            break;
        case ("itemWithBlankSpace"):
            return host + "namazuTranslator/itemWithBlankSpace";
            break;
        default: {
            return host;
        }
    }
};
exports.parseResponseResult = (data) => {
    Object.keys(data).forEach(key => {
        if (data[key] === null) {
            data[key] = '未找到该物品';
        }
    });
    return data;
};
exports.parseEngUpper = (string) => {
    let wordArray = string.split(' ');
    for (let i = 0; i < wordArray.length; i++) {
        let word = wordArray[i];
        if (word !== 'of' && word.length > 0) {
            let charArray = word.split('');
            charArray[0] = charArray[0].toUpperCase();
            wordArray[i] = charArray.join('');
        }
    }
    return wordArray.join(' ');
};
exports.getJSONData = (url) => {
    return new Promise((resolve, reject) => {
        wx.request({
            url: url,
            method: 'GET',
            dataType: 'json',
            success(res) {
                resolve(res);
            },
            fail(err) {
                reject(err);
            }
        });
    });
};
exports.request = (url, method, dataType) => {
    return new Promise((resolve, reject) => {
        wx.request({
            url: url,
            method: method,
            dataType: dataType,
            success(res) {
                resolve(res);
            },
            fail(err) {
                reject(err);
            }
        });
    });
};
const formatNumber = (n) => {
    const s = n.toString();
    return s[1] ? s : '0' + s;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFFYSxRQUFBLFVBQVUsR0FBRyxDQUFDLElBQVUsRUFBRSxFQUFFO0lBQ3ZDLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQTtJQUMvQixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQ2pDLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQTtJQUMxQixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUE7SUFDNUIsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFBO0lBQ2hDLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQTtJQUVoQyxPQUFPLENBQ0wsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDO1FBQzlDLEdBQUc7UUFDSCxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FDbkQsQ0FBQTtBQUNILENBQUMsQ0FBQTtBQUNZLFFBQUEsZ0JBQWdCLEdBQUcsR0FBRSxFQUFFO0lBQ2xDLElBQUksV0FBVyxHQUFHLHNCQUFjLEVBQUUsQ0FBQTtJQUNsQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBUSxFQUFFLEVBQUU7UUFDNUIsSUFBSSxHQUFHLEVBQUU7WUFDUCxJQUFJLFlBQVksR0FBRyx1QkFBZSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7WUFDdEUsSUFBSSxZQUFZLEdBQUcsb0JBQVksRUFBRSxDQUFB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RyxFQUFFLEdBQUc7WUFDUixNQUFNLEVBQUUsS0FBSztZQUNiLFFBQVEsRUFBRSxNQUFNO1lBQ2hCLE9BQU8sQ0FBQyxHQUFHO2dCQUNULE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQTtZQUNkLENBQUM7WUFDRCxJQUFJLENBQUMsR0FBRztnQkFDTixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDYixDQUFDO1NBQ0YsQ0FBQyxDQUFBO0lBQ0osQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDLENBQUE7QUFDWSxRQUFBLE9BQU8sR0FBRyxDQUFDLEdBQVcsRUFBRSxNQUFXLEVBQUUsUUFBYSxFQUFFLEVBQUU7SUFDakUsT0FBTyxJQUFJLE9BQU8sQ0FBaUQsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEVBQUU7UUFDckYsRUFBRSxDQUFDLE9BQU8sQ0FBQztZQUNULEdBQUcsRUFBRSxHQUFHO1lBQ1IsTUFBTSxFQUFFLE1BQU07WUFDZCxRQUFRLEVBQUUsUUFBUTtZQUNsQixPQUFPLENBQUMsR0FBRztnQkFDVCxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDZCxDQUFDO1lBQ0QsSUFBSSxDQUFDLEdBQUc7Z0JBQ04sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1lBQ2IsQ0FBQztTQUNGLENBQUMsQ0FBQTtJQUNKLENBQUMsQ0FBQyxDQUFBO0FBQ0osQ0FBQyxDQUFBO0FBQ0QsTUFBTSxZQUFZLEdBQUcsQ0FBQyxDQUFTLEVBQUUsRUFBRTtJQUNqQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUE7SUFDdEIsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQTtBQUMzQixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEYXRhVmVyc2lvbiB9IGZyb20gXCIuL2NsYXNzXCJcblxuZXhwb3J0IGNvbnN0IGZvcm1hdFRpbWUgPSAoZGF0ZTogRGF0ZSkgPT4ge1xuICBjb25zdCB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpXG4gIGNvbnN0IG1vbnRoID0gZGF0ZS5nZXRNb250aCgpICsgMVxuICBjb25zdCBkYXkgPSBkYXRlLmdldERhdGUoKVxuICBjb25zdCBob3VyID0gZGF0ZS5nZXRIb3VycygpXG4gIGNvbnN0IG1pbnV0ZSA9IGRhdGUuZ2V0TWludXRlcygpXG4gIGNvbnN0IHNlY29uZCA9IGRhdGUuZ2V0U2Vjb25kcygpXG5cbiAgcmV0dXJuIChcbiAgICBbeWVhciwgbW9udGgsIGRheV0ubWFwKGZvcm1hdE51bWJlcikuam9pbignLycpICtcbiAgICAnICcgK1xuICAgIFtob3VyLCBtaW51dGUsIHNlY29uZF0ubWFwKGZvcm1hdE51bWJlcikuam9pbignOicpXG4gIClcbn1cbmV4cG9ydCBjb25zdCBpbml0QXV4aWxhcnlEYXRhID0gKCk9PntcbiAgbGV0IGRhdGFWZXJzaW9uID0gZ2V0RGF0YVZlcnNpb24oKVxuICBkYXRhVmVyc2lvbi50aGVuKChyZXM6IGFueSkgPT4ge1xuICAgIGlmIChyZXMpIHtcbiAgICAgIGxldCBzZXRMb2NhbFN0b3IgPSBzZXRMb2NhbFN0b3JhZ2UoJ2RhdGFWZXJzaW9uJywgSlNPTi5zdHJpbmdpZnkocmVzKSlcbiAgICAgIGxldCBzZXRFbXB0eURhdGEgPSBnZXRFbXB0eURhdGEoKVxuICAgICAgc2V0TG9jYWxTdG9yLnRoZW4oKHJlczogYW55KSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgIH0pLmNhdGNoKChlcnI6IGFueSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgICB9KVxuICAgICAgc2V0RW1wdHlEYXRhLnRoZW4oKHJlczphbnkpPT57XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgIH0pXG4gICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICB0aXRsZTogJ+aVsOaNrueJiOacrOW3suabtOaWsCcsXG4gICAgICAgIGljb246ICdzdWNjZXNzJyxcbiAgICAgICAgZHVyYXRpb246IDE1MDBcbiAgICAgIH0pXG4gICAgfVxuICB9KVxufVxuXG5leHBvcnQgY29uc3QgZ2V0RW1wdHlEYXRhID0gKCkgPT57IC8v6I635Y+W5bim56m65qC855qE54mp5ZOB5ZCN56ewXG4gIHJldHVybiBuZXcgUHJvbWlzZTxib29sZWFuPigocmVzb2x2ZSxyZWplY3QpPT57XG4gICAgbGV0IGJsYW5rSXRlbXMgPSB7XG4gICAgICBcInpoX2NuXCI6IFsnJ10sIFxuICAgICAgXCJqYV9qcFwiOiBbJyddXG4gICAgfVxuICAgIGxldCBibGFua0l0ZW1Qcm9taXNlID0gZ2V0SlNPTkRhdGEoZ2V0QVBJUGF0aCgnaXRlbVdpdGhCbGFua1NwYWNlJywnemgtY24nKSlcbiAgICBibGFua0l0ZW1Qcm9taXNlLnRoZW4oKHJlczphbnkpPT57XG4gICAgICBjb25zb2xlLmxvZyhyZXMpXG4gICAgICBsZXQgcmVzRGF0YSA9IHJlcy5kYXRhXG4gICAgICByZXNEYXRhLnpoX2NuLmZvckVhY2goKGU6YW55KSA9PiB7XG4gICAgICAgIGJsYW5rSXRlbXMuemhfY24ucHVzaChlLkl0ZW1OYW1lKVxuICAgICAgfSlcbiAgICAgIHJlc0RhdGEuamFfanAuZm9yRWFjaCgoZTphbnkpID0+IHtcbiAgICAgICAgYmxhbmtJdGVtcy5qYV9qcC5wdXNoKGUuSXRlbU5hbWUpXG4gICAgICB9KVxuICAgICAgbGV0IHN0b3JQcm9taXNlID0gc2V0TG9jYWxTdG9yYWdlKCdibGFua0l0ZW1zJyxKU09OLnN0cmluZ2lmeShibGFua0l0ZW1zKSlcbiAgICAgIHN0b3JQcm9taXNlLnRoZW4ocmVzPT57XG4gICAgICAgIHJlc29sdmUocmVzKVxuICAgICAgfSkuY2F0Y2goZXJyPT57XG4gICAgICAgIHJlamVjdChlcnIpXG4gICAgICB9KVxuICAgIH0pLmNhdGNoKGVycj0+e1xuICAgICAgcmVqZWN0KGVycilcbiAgICB9KVxuICB9KVxufVxuXG5leHBvcnQgY29uc3QgZ2V0RGF0YVZlcnNpb24gPSAoKSA9PiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZTxEYXRhVmVyc2lvbj4oKHJlc29sdmUscmVqZWN0KT0+e1xuICAgIGxldCBkYXRhVmVyc2lvbiA9IGdldEpTT05EYXRhKGdldEFQSVBhdGgoXCJkYXRhVmVyc2lvblwiLCBcInpoLWNuXCIpKVxuICAgIGRhdGFWZXJzaW9uLnRoZW4oKHJlczogYW55KSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhyZXMuZGF0YSlcbiAgICAgIHJlc29sdmUocmVzLmRhdGEpXG4gICAgfSkuY2F0Y2goZXJyID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGVycilcbiAgICAgIHJlamVjdChmYWxzZSlcbiAgICB9KVxuICAgIH0pXG59XG5cbmV4cG9ydCBjb25zdCBzZXRMb2NhbFN0b3JhZ2UgPSAoa2V5OiBzdHJpbmcsIGRhdGE6IHN0cmluZykgPT4ge1xuICByZXR1cm4gbmV3IFByb21pc2U8Ym9vbGVhbj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIHd4LnNldFN0b3JhZ2Uoe1xuICAgICAga2V5OiBrZXksXG4gICAgICBkYXRhOiBkYXRhLFxuICAgICAgc3VjY2VzcyhyZXMpIHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzKVxuICAgICAgICByZXNvbHZlKHRydWUpXG4gICAgICB9LFxuICAgICAgZmFpbChlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgICByZWplY3QoZmFsc2UpXG4gICAgICB9XG4gICAgfSlcbiAgfSlcbn1cbmV4cG9ydCBjb25zdCBnZXRMb2NhbFN0b3JhZ2UgPSAoa2V5OiBzdHJpbmcpID0+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlPGFueT4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIHd4LmdldFN0b3JhZ2Uoe1xuICAgICAga2V5OiBrZXksXG4gICAgICBzdWNjZXNzKHJlcykge1xuICAgICAgICBjb25zb2xlLmxvZyhyZXMuZGF0YSlcbiAgICAgICAgcmVzb2x2ZShyZXMuZGF0YSlcbiAgICAgIH0sXG4gICAgICBmYWlsKGVycikge1xuICAgICAgICByZWplY3QoZXJyKVxuICAgICAgfVxuICAgIH0pXG4gIH0pXG59XG5leHBvcnQgY29uc3QgcmVtb3ZlTG9jYWxTdG9yYWdlID0gKGtleTogc3RyaW5nKSA9PiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZTxib29sZWFuPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgd3gucmVtb3ZlU3RvcmFnZSh7XG4gICAgICBrZXk6IGtleSxcbiAgICAgIHN1Y2Nlc3MocmVzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgICAgcmVzb2x2ZSh0cnVlKVxuICAgICAgfSxcbiAgICAgIGZhaWwoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycilcbiAgICAgICAgcmVqZWN0KGZhbHNlKVxuICAgICAgfVxuICAgIH0pXG4gIH0pXG59XG5leHBvcnQgY29uc3QgZ2V0QVBJUGF0aCA9IChlbmRQb2ludDogc3RyaW5nLCBzb3VyY2VMYW5nOiBzdHJpbmcgPSAnemgtY24nKSA9PiB7XG4gIGxldCBob3N0ID0gXCJodHRwczovL2RpcnVzZWMuY29tL25hbWF6dS9hcGkvXCJcbiAgc3dpdGNoIChlbmRQb2ludCkge1xuICAgIGNhc2UgKFwiaXRlbVwiKTpcbiAgICAgIHJldHVybiBob3N0ICsgXCJuYW1henVUcmFuc2xhdG9yL2l0ZW0/bGFuZz1cIiArIHNvdXJjZUxhbmdcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgKFwiZGF0YVZlcnNpb25cIik6XG4gICAgICByZXR1cm4gaG9zdCArIFwibmFtYXp1VHJhbnNsYXRvci9kYXRhVmVyc2lvblwiXG4gICAgICBicmVhaztcbiAgICBjYXNlIChcIml0ZW1XaXRoQmxhbmtTcGFjZVwiKTpcbiAgICAgIHJldHVybiBob3N0ICsgXCJuYW1henVUcmFuc2xhdG9yL2l0ZW1XaXRoQmxhbmtTcGFjZVwiXG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OiB7XG4gICAgICByZXR1cm4gaG9zdFxuICAgIH1cbiAgfVxufVxuZXhwb3J0IGNvbnN0IHBhcnNlUmVzcG9uc2VSZXN1bHQgPSAoZGF0YTphbnkpID0+IHtcbiAgT2JqZWN0LmtleXMoZGF0YSkuZm9yRWFjaChrZXk9PntcbiAgICBpZihkYXRhW2tleV0gPT09IG51bGwpe1xuICAgICAgZGF0YVtrZXldID0gJ+acquaJvuWIsOivpeeJqeWTgSdcbiAgICB9XG4gIH0pXG4gIHJldHVybiBkYXRhXG59XG5cblxuZXhwb3J0IGNvbnN0IHBhcnNlRW5nVXBwZXIgPSAoc3RyaW5nOnN0cmluZykgPT4ge1xuICBsZXQgd29yZEFycmF5ID0gc3RyaW5nLnNwbGl0KCcgJylcbiAgZm9yKGxldCBpID0gMDtpPHdvcmRBcnJheS5sZW5ndGg7aSsrKXtcbiAgICBsZXQgd29yZCA9IHdvcmRBcnJheVtpXVxuICAgIGlmICh3b3JkICE9PSAnb2YnICYmIHdvcmQubGVuZ3RoPjApe1xuICAgICAgbGV0IGNoYXJBcnJheSA9IHdvcmQuc3BsaXQoJycpXG4gICAgICBjaGFyQXJyYXlbMF0gPSBjaGFyQXJyYXlbMF0udG9VcHBlckNhc2UoKVxuICAgICAgd29yZEFycmF5W2ldID0gY2hhckFycmF5LmpvaW4oJycpXG4gICAgfVxuICB9XG4gIHJldHVybiB3b3JkQXJyYXkuam9pbignICcpXG59XG5leHBvcnQgY29uc3QgZ2V0SlNPTkRhdGEgPSAodXJsOiBzdHJpbmcpID0+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlPFdlY2hhdE1pbmlwcm9ncmFtLlJlcXVlc3RTdWNjZXNzQ2FsbGJhY2tSZXN1bHQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICB3eC5yZXF1ZXN0KHtcbiAgICAgIHVybDogdXJsLFxuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICBzdWNjZXNzKHJlcykge1xuICAgICAgICByZXNvbHZlKHJlcylcbiAgICAgIH0sXG4gICAgICBmYWlsKGVycikge1xuICAgICAgICByZWplY3QoZXJyKVxuICAgICAgfVxuICAgIH0pXG4gIH0pXG59XG5leHBvcnQgY29uc3QgcmVxdWVzdCA9ICh1cmw6IHN0cmluZywgbWV0aG9kOiBhbnksIGRhdGFUeXBlOiBhbnkpID0+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlPFdlY2hhdE1pbmlwcm9ncmFtLlJlcXVlc3RTdWNjZXNzQ2FsbGJhY2tSZXN1bHQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICB3eC5yZXF1ZXN0KHtcbiAgICAgIHVybDogdXJsLFxuICAgICAgbWV0aG9kOiBtZXRob2QsXG4gICAgICBkYXRhVHlwZTogZGF0YVR5cGUsXG4gICAgICBzdWNjZXNzKHJlcykge1xuICAgICAgICByZXNvbHZlKHJlcylcbiAgICAgIH0sXG4gICAgICBmYWlsKGVycikge1xuICAgICAgICByZWplY3QoZXJyKVxuICAgICAgfVxuICAgIH0pXG4gIH0pXG59XG5jb25zdCBmb3JtYXROdW1iZXIgPSAobjogbnVtYmVyKSA9PiB7XG4gIGNvbnN0IHMgPSBuLnRvU3RyaW5nKClcbiAgcmV0dXJuIHNbMV0gPyBzIDogJzAnICsgc1xufVxuIl19